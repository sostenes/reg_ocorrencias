<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pt-br">

<head>
	<title>Curso iMasters - Web Sites com Ajax - Cap&iacute;tulo 5 - Compreendendo a página actions.php</title>
	<meta http-equiv="Content-Type"  content="application/xhtml+xml; charset=iso-8859-1" />
	<meta name="author" content="Leandro Vieira Pinho [ leandro@plugsites.net ]" />
	<meta name="language" content="pt-br" />
	<script type="text/javascript" src="js/perform.js"></script>
	<style type="text/css" media="screen">
		/*<![CDATA[*/
		<!--
			@import "css/style.css";
		-->
		/*]]>*/
	</style>
	<link rel="shortcut icon" href="img/favicon_imasters.gif" type="image/x-icon" />
</head>

<body>

<div id="global">

<h1 id="header">Web Sites com Ajax</h1>

<div id="conteudo">
	<h3 id="txtProjetoFinal">JavaScript</h3>

	<div id="curso">
		<h2>Compreendendo a página actions.php</h2>
		
		<p>Como dito anteriormente, a página <a href="visualizar_paginas/actions.phps">actions.php</a> desempenhará as principais funções do aplicativo, ou seja, incluirá, editará e excluirá os contatos desejados da agenda. </p>
		<p>Sendo assim, vamos analisá-la passo-a-passo.</p>
		<p><img src="img_curso/cap5/pg_actions_inserindo_outras_pgs.gif" width="480" height="52" alt="Incluindo arquivos na página" title="Incluindo arquivos na página" /></p>
		
		<p>	    A página inicia incluindo as p&aacute;ginas  <a href="visualizar_paginas/class.MySQL.phps">class.MySQL.php</a> e <a href="visualizar_paginas/functions.phps">functions.php</a>, ambas já familiares para nós. &Eacute;  importante e necessário  compreender nessa inclusão  a condição que é verificada para que ela seja realizada.</p>
		
		<p>Assim,  as páginas serão inclu&iacute;das somente se estivermos trabalhando via Ajax, seja na inclusão de registros - <strong>isset($_GET['ajax'])</strong> - ou na edição dos dados - <strong>isset($_GET['editar'])</strong> - e  não devem ser inseridas se existir a variável <strong>exibirFormulario</strong> na URL.</p>
		
		<p>Mas, por que isso? Pense comigo: a página <strong>index.php</strong> também realiza este mesmo processo, ou seja, incluir as referidas páginas. Ok, mas se ela (index.php) já inseriu por que iremos inserir novamente? </p>
		<p>Não iremos inserir novamente, simplesmente iremos utilizar a página <strong>actions.php</strong> também através do Ajax e para isso, ela precisa que tais páginas estejam inclusas. </p>
		<p>Então, verificamos através de uma condição se a página está sendo acessada via Ajax, caso esteja, inclu&iacute;mos as páginas necessárias - <a href="visualizar_paginas/class.MySQL.phps">class.MySQL.php</a> e <a href="visualizar_paginas/functions.phps">functions.php</a>.</p>
		<p>Em seguinda temos outra condição, vejamos:</p>
		
		<p><img src="img_curso/cap5/pg_actions_if_request_action.gif" width="243" height="24" alt="Verificando se o formulário foi submetido" title="Verificando se o formulário foi submetido" /></p>
		
		<p>Sendo simplista,  ela verifica se o formulário foi submetido. Onde <strong>action</strong> é igual ao nome de um campo do  formulário.</p>
		
		<p>Logo após essa verificação, criaremos algumas variáveis que conterão os dados informados no formulário. Observemos:</p>
		
		<p><img src="img_curso/cap5/pg_actions_pegando_dados_form.gif" width="480" height="123" alt="Pegando os dados informado no formulário" title="Pegando os dados informado no formulário" /></p>
		
		<p>Bom, o diferencial aí está na condição <strong>isset($_GET['ajax'])</strong>, ou seja, se existir a variável <strong>ajax</strong> na <strong>URL</strong>, compreendemos que estamos trabalhando via Ajax. Assim,  utilizaremos a função <strong>formatDataAjax</strong> e, quando não estivermos trabalhando via Ajax, usaremos a <strong>formatData</strong>. Ambas  estão localizadas na página <a href="visualizar_paginas/functions.phps">functions.php</a>.</p>
		<p>As duas funções  diferenciam-se apenas por duas linhas de códigos a mais na função <strong>formatDataAjax</strong>. Repare-as:</p>
		
		<p><img src="img_curso/cap5/pg_actions_linhas_a_mais_funcao_formatDataAjax.gif" width="197" height="35" alt="O diferencial da função formatDataAjax" title="O diferencial da função formatDataAjax" /></p>
		
		<p>Para você perceber o quanto elas são importantes e essenciais, vou lhe mostrar como os dados são inseridos no banco de dados, sem e com a utilização dessas linhas.</p>
		
		<p><img src="img_curso/cap5/dados_no_db_com_e_sem_decodificacao.gif" width="400" height="83" alt="Exemplos dos dados armazenados no banco de dados" title="Exemplos dos dados armazenados no banco de dados" /></p>
		
		<p>Atente-se ao seguinte, elas são utilizadas somente quando os dados são inseridos via Ajax.</p>
		
		<p>O próximo passo é a verificação dos dados, ou seja, se os dados necessários foram informados e se o e-mail &eacute; válido. </p>
		<p>Esses dados serão utilizados ao trabalharmos sem o Ajax. Quando trabalharmos com ele, a validação será feita pelo JavaScript (abordaremos isso logo mais).</p>
		<p>Se os dados passarem corretamente na validação, prosseguimos e cadastraremos um novo contato ou editaremos os dados de um contato já cadastrado. </p>
		<p>Vamos observar a  imagem de exemplo:</p>
		<p><img src="img_curso/cap5/pg_actions_if_erro_vazio.gif" width="480" height="300" alt="Inclusão e edição dos dados" title="Inclusão e edição dos dados" /></p>
		
		<p>A variável <strong>action</strong> armazena o dado atribu&iacute;do ao campo oculto action do formulário (falaremos sobre ele ainda). Esse dado será <strong>cadastrar</strong> ou <strong>editar</strong>  utilizando o switch (nada mais é do que uma série de instruções IFs seguidas)  e verificaremos qual dado foi atribu&iacute;do &agrave; variável no momento.</p>
		
		<p>Se tivermos cadastrar atribuído a variável, cadastramos. Se tivermos editar atribuído editamos.</p>
		
		<p>Atente-se que há algumas particularidades desse código exemplificado na imagem acima: <strong>$mySQL</strong> é um objeto que criamos - <strong>$mySQL = new MySQL - </strong>   na página <a href="visualizar_paginas/class.MySQL.phps">class.MySQL.php</a>. O redirecionamento para a página <a href="visualizar_paginas/index.phps">index.php</a> será feito somente se não tivermos trabalhando com o Ajax.</p>
		<p>A página  <a href="visualizar_paginas/actions.phps">actions.php</a> &eacute;  finalizada com o seguinte código:</p>
		
		<p><img src="img_curso/cap5/pg_actions_if_excluir.gif" width="480" height="128" alt="Código de exclusão de registros" title="Código de exclusão de registros" /></p>
		
		<p>Esse c&oacute;digo verifica se há na <strong>URL</strong> a variável <strong>excluir</strong>. Havendo, será executado a exclusão de um registro de acordo com o ID informado.</p>
		
		<p>Na próxima unidade, falaremos sobre o formulário e suas peculiaridades.</p>
		
		<ul id="navigation">
			<li><a href="5.6.htm" id="linkNavCap5" title="Projeto Final - Compreendendo a página index.php">&laquo; Compreendendo a página index.php</a></li>
			<li>|</li>
			<li><a href="5.8.htm" id="linkNavCap5" title="Projeto Final - Compreendendo a página formulario.php">Compreendendo a página formulario.php &raquo;</a></li>
		</ul>
	</div>
</div>
<!-- conteudo -->

<div id="sideBar">
	<ul id="menu">
		<li><a href="index.htm" class="itemMenu" title="Introdução do curso">Introdução</a></li>
		<li><a href="1.htm" class="itemMenu" id="linkCap1" title="JavaScript">Capítulo 1</a>
			<ul id="cap1">
				<li class="titCap">JavaScript</li>
				<li><a href="1.htm" title="Prefácio">Prefácio</a></li>
				<li><a href="1.1.htm" title="Introdução ao JavaScript">Introdução ao JavaScript</a></li>
				<li><a href="1.2.htm" title="Variáveis">Variáveis</a></li>
				<li><a href="1.3.htm" title="Operadores">Operadores</a></li>
				<li><a href="1.4.htm" title="Condições">Condições</a></li>
				<li><a href="1.5.htm" title="Popup Boxes">Popup Boxes</a></li>
				<li><a href="1.6.htm" title="Loops">Loops</a></li>
				<li><a href="1.7.htm" title="Funções">Funções</a></li>
				<li><a href="1.8.htm" title="Eventos">Eventos</a></li>
				<li><a href="1.9.htm" title="Array">Array</a></li>
				<li><a href="1.10.htm" title="Data">Data</a></li>
				<li><a href="1.11.htm" title="String">String</a></li>
				<li><a href="1.12.htm" title="Math">Math</a></li>
				<li><a href="1.13.htm" title="Validação de formulários">Validação de formulários</a>
			</ul>
		</li>
		<li><a href="2.htm" class="itemMenu" id="linkCap2" title="DOM e DHTML">Capítulo 2</a>
			<ul id="cap2">
				<li class="titCap">DOM e DHTML</li>
				<li><a href="2.htm" title="Prefácio">Prefácio</a></li>
				<li><a href="2.1.htm" title="Introdução ao DOM">Introdução ao DOM</a></li>
				<li><a href="2.2.htm" title="Introdução ao DHTML">Introdução ao DHTML</a></li>
				<li><a href="2.3.htm" title="Método: getElementById">Método: getElementById</a></li>
				<li><a href="2.4.htm" title="Método: getElementsByTagName">Método: getElementsByTagName</a></li>
				<li><a href="2.5.htm" title="Método: style">Método: style</a></li>
				<li><a href="2.6.htm" title="Método: className">Método: className</a></li>
				<li><a href="2.7.htm" title="Método: innerHTML">Método: innerHTML</a></li>
				<li><a href="2.8.htm" title="Método: appendChild">Método: appendChild</a></li>
				<li><a href="2.9.htm" title="Método: createElement">Método: createElement</a></li>
				<li><a href="2.10.htm" title="Método: insertBefore">Método: insertBefore</a></li>
				<li><a href="2.11.htm" title="Método: insertAfter">Método: insertAfter</a></li>
				<li><a href="2.12.htm" title="Método: setAttribute">Método: setAttribute</a></li>
				<li><a href="2.13.htm" title="Método: getAttribute">Método: getAttribute</a></li>

			</ul>
		</li>
		<li><a href="3.htm" class="itemMenu" id="linkCap3" title="JavaScript não-obstrutivo">Capítulo 3</a>
			<ul id="cap3">
				<li class="titCap">JavaScript não-obstrutivo</li>
				<li><a href="3.htm" title="Prefácio">Prefácio</a></li>
				<li><a href="3.1.htm" title="Introdução ao JavaScript não-obstrutivo">Introdução ao JavaScript não-obstrutivo</a></li>
			</ul>
		</li>
		<li><a href="4.htm" class="itemMenu" id="linkCap4" title="Ajax">Capítulo 4</a>
			<ul id="cap4">
				<li class="titCap">Ajax</li>
				<li><a href="4.htm" title="Prefácio">Prefácio</a></li>
				<li><a href="4.1.htm" title="Introdução ao Ajax">Introdução ao Ajax</a></li>
				<li><a href="4.2.htm" title="O Objeto XMLHttpRequest">O Objeto XMLHttpRequest</a>
				<li><a href="4.3.htm" title="Pés no chão">Pés no chão</a>
			</ul>
		</li>
		<li><a href="5.htm" class="itemMenu" id="linkCap5" title="Projeto final">Capítulo 5</a>
			<ul id="cap5">
				<li class="titCap">Projeto final</li>
				<li><a href="5.htm" title="Prefácio">Prefácio</a></li>
				<li><a href="5.1.htm" title="Introdução ao Projeto final">Introdução ao Projeto final</a></li>
				<li><a href="5.2.htm" title="Tabela do banco de dados">Tabela do banco de dados</a></li>
				<li><a href="5.3.htm" title="Visão geral">Visão geral</a></li>
				<li><a href="5.4.htm" title="Visão geral sobre as páginas">Visão geral sobre as páginas</a></li>
				<li><a href="5.5.htm" title="Compreendendo o espírito da 'coisa'">Compreendendo o espírito da 'coisa'</a></li>
				<li><a href="5.6.htm" title="Compreendendo a página index.php">Compreendendo a página index.php</a></li>
				<li><a href="5.7.htm" title="Compreendendo a página actions.php">Compreendendo a página action.php</a></li>
				<li><a href="5.8.htm" title="Compreendendo a página formulario.php">Compreendendo a página formulario.php</a></li>
				<li><a href="5.9.htm" title="Compreendendo a página relatorio.php">Compreendendo a página relatorio.php</a></li>
				<li><a href="5.10.htm" title="Compreendendo a página comportamentos.js">Compreendendo a página comportamentos.js</a></li>
				<li><a href="5.11.htm" title="Considerações finais">Considerações finais</a></li>			
			</ul>
		</li>
		<li><a href="6.htm" class="itemMenu" id="linkCap6" title="Bibliografia">Bibliografia</a>
			<ul id="cap6">
				<li class="titCap">Bibliografia</li>
				<li><a href="6.htm" title="">Referências bibliográficas</a></li>
			</ul>
		</li>
	</ul>
	<p id="changeFontSize"><a href="javascript:changeFontSize();" title="Alterar o tamanho da fonte">&raquo; Tamanho da fonte</a></p>
</div>
<!-- / Sidebar -->
	
<div id="frameScroll">
	<a href="#" title="Ocultar / Exibir o menu" id="optFrameScroll">
		<img src="img/icn/icone_frame_scroll_hide.jpg" width="6" height="50" alt="" />
	</a>
</div>
	
<div id="rodape">

</div>
<!-- Rodape -->

</div>
<!-- / Global -->

</body>
</html>